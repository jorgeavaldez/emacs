#+title: Jorge's Literate Emacs Config
#+startup: overview
#+property: header-args:emacs-lisp :tangle config.el

* Intro
This is a minimal scaffold. Keep it simple, readable, and easy to extend.

* Formatting this =config.org= (manual, no automation yet)
This is the safest literate workflow for formatting Lisp in Org source blocks:
- In an Org src block, run =M-x org-edit-special= (key: =C-c '=).
  - This opens the block in a dedicated Emacs Lisp editing buffer.
- In that edit buffer, format indentation with =M-x indent-region= (key: =C-M-\=).
  - Use =M-x mark-whole-buffer= first if you want to indent the entire block.
- Return to =config.org= with =M-x org-edit-src-exit= (key: =C-c '=).

This keeps formatting focused on code blocks and avoids accidental edits to surrounding Org text.

* ðŸš¨ NEOVIM -> EMACS SURVIVAL CHEATSHEET ðŸš¨
** Key notation
- =C-= means Ctrl
- =M-= means Meta (usually Alt/Option, or press =Esc= then key)

** Leader-first essentials (new default)
- =SPC SPC= :: command palette (=M-x=)
- =SPC f f= :: open file
- =SPC b b= :: switch buffer (Consult)
- =SPC /= :: project grep (ripgrep)
- =SPC s l= :: search in current buffer
- =SPC s i= :: jump to symbol (imenu)
- =SPC s o= :: jump to outline heading
- =SPC ?= :: show available leader bindings

** Get unstuck / quit prompts
- =C-g= :: cancel current command (most important panic key)
- =Esc Esc Esc= :: broad "get me out" escape
- =q= :: quit many special/help buffers

** Discover keybindings (current context)
- =SPC= then pause :: show which-key popup for leader bindings
- =SPC ?= :: force-open top-level leader help
- =C-h m= :: show bindings/docs for current major/minor modes
- =C-h b= :: show all active keybindings right now
- =C-h k= then key :: explain what that key does
- =M-x where-is RET <command>= :: find keybinding for a command

** Movement
- =C-f / C-b= :: right / left
- =C-n / C-p= :: down / up
- =C-a / C-e= :: beginning / end of line
- =M-f / M-b= :: forward / backward word
- =M-<= / =M->= :: top / bottom of buffer
- =C-v / M-v= :: page down / page up
- In Evil normal state: =C-d= and =C-u= already do Vim-style half-page scrolling

** Window/buffer basics
- =C-x o= :: move to other window
- =C-x 2= / =C-x 3= :: split below / split right
- =C-x 0= :: close current window
- =C-x 1= :: keep only current window
- =C-x b= :: switch buffer
- =C-x k= :: kill buffer

** Open files by path
- =C-x C-f= :: open file by path (=find-file=)
- Type absolute path (e.g. =~/.config/emacs/config.org=) or relative path, then =RET=
- Press =TAB= for path completion while typing
- =M-p / M-n= :: previous/next path history in minibuffer
- =C-x C-v= :: visit a different file from current buffer

** Search (Vim =/= style equivalent)
- =C-s= :: incremental forward search (closest built-in to Vim =/=)
- =C-r= :: incremental backward search
- While searching: =C-s= next match, =C-r= previous match
- =RET= :: finish search at current match
- =C-g= :: cancel search and jump back to search start
- =M-e= :: edit search string in minibuffer

** Dired (file manager)
- =C-x d= :: open Dired prompt
- Enter a directory path then =RET= (e.g. =~/.config/emacs= or =.=)
- In Dired:
  - =RET= open file/dir
  - =^= go to parent directory
  - =g= refresh listing

** Reload file/config
- =M-x revert-buffer RET= :: reload current file from disk (after external changes)
- In Dired, =g= refreshes the listing
- Reload this literate config:
  - =M-: (org-babel-load-file (expand-file-name "config.org" user-emacs-directory)) RET=

** Undo / redo
- =C-/= :: undo (also =C-_= or =C-x u=)
- =M-x undo-redo= :: redo (Emacs 28+)

** Org folding (headings)
- =TAB= on a heading :: cycle that subtree folded/children/all
- =S-TAB= :: cycle visibility for whole Org buffer
- =M-x org-cycle= / =M-x org-shifttab= :: command equivalents

** Format this literate config (Org + Lisp blocks)
- Open current src block in dedicated edit buffer:
  - key: =C-c '=, command: =M-x org-edit-special=
- Reindent code in that edit buffer:
  - key: =C-M-\=, command: =M-x indent-region=
  - useful helper: =M-x mark-whole-buffer= before =indent-region=
- Return from src edit buffer to Org:
  - key: =C-c '=, command: =M-x org-edit-src-exit=

** Save / quit Emacs
- =C-x C-s= :: save current buffer
- =C-x s= :: save modified buffers
- =C-x C-c= :: quit Emacs

** Evaluate Lisp quickly
- =C-x b *scratch* RET= :: open scratch buffer
- =C-j= :: eval previous sexp and insert result
- =C-x C-e= :: eval sexp before point (minibuffer result)
- =M-x ielm= :: interactive Emacs Lisp REPL

* Hello world + startup basics
#+begin_src emacs-lisp
;; Keep Customize UI output out of init.el.
(setq custom-file (expand-file-name "custom.el" user-emacs-directory))
(when (file-exists-p custom-file)
  (load custom-file nil 'nomessage))

(setq inhibit-startup-screen t
      initial-scratch-message nil
      ring-bell-function 'ignore)

(add-hook 'emacs-startup-hook
          (lambda ()
            (message "hello world from config.org")))
#+end_src

* Phase context (self-contained notes)
This mirrors your migration plan so this file is understandable on its own.

- *Tier 1* (do now): daily muscle memory and core coding loop
  - modal editing, leader keys, key discovery
  - find/search/navigation
- *Tier 2* (next): weekly conveniences (extra workflow helpers, more mappings)
- *Tier 3* (later): optional/rare mappings and polish

In this file, the new sections below implement Tier 1 only.

* Package bootstrap (built-in =package.el= + =use-package=)
What this does:
- enables Emacs package repositories
- ensures =use-package= exists
- makes package declarations consistent and readable

Why:
- this is the simplest "official Emacs" path while learning
- every package below is declared in one place with =use-package=

Note on local files:
- package downloads live in =elpa/= and cache/history files (e.g. =history=, =var/=)
- those are machine-local and are ignored via =.gitignore=

#+begin_src emacs-lisp
(require 'package)

;; Standard package sources.
(setq package-archives
      '(("gnu"    . "https://elpa.gnu.org/packages/")
        ("nongnu" . "https://elpa.nongnu.org/nongnu/")
        ("melpa"  . "https://melpa.org/packages/")))

(package-initialize)

;; Install use-package once, then reuse it everywhere below.
(unless (package-installed-p 'use-package)
  (unless package-archive-contents
    (package-refresh-contents))
  (package-install 'use-package))

(require 'use-package)

;; Default: automatically install missing packages declared with use-package.
(setq use-package-always-ensure t)
#+end_src

* Phase 1 / Step 1: key model (Evil + leader + which-key)
What each package is for:
- =evil=: Vim modal editing in Emacs (normal/insert/visual/etc.)
- =evil-collection=: makes many built-in/package buffers feel Vim-consistent
- =which-key=: shows available key completions after a prefix (great for learning)

Why this setup:
- preserve your Neovim muscle memory
- keep a *small* Tier 1 map first (daily essentials only)
- use Space as leader (Spacemacs-style), plus =SPC SPC= for command palette (=M-x=)

#+begin_src emacs-lisp
  (use-package evil
    :init
    ;; Must be set before Evil loads.
    (setq evil-want-integration t
          evil-want-keybinding nil
          evil-want-C-u-scroll t
          evil-undo-system 'undo-redo)
    :config
    (evil-mode 1))

  (use-package evil-collection
    :after evil
    :config
    (evil-collection-init))

  (use-package which-key
    :defer 0
    :config
    (which-key-mode 1)
    (setq which-key-idle-delay 0.35))

  (defvar jorge/leader-map (make-sparse-keymap)
    "Leader keymap for Evil normal/visual/motion states.")

  (defun jorge/reload-literate-config ()
    "Reload config.org."
    (interactive)
    (org-babel-load-file (expand-file-name "config.org" user-emacs-directory)))

  ;; Non-modal fallback for leader mappings.
  (global-set-key (kbd "C-c SPC") jorge/leader-map)

  (with-eval-after-load 'evil
    (define-key evil-normal-state-map (kbd "SPC") jorge/leader-map)
    (define-key evil-visual-state-map (kbd "SPC") jorge/leader-map)
    (define-key evil-motion-state-map (kbd "SPC") jorge/leader-map))

  ;; we need to define spc to my leader-map in all modes
  ;; so we define our own "global jorge mode" and redefine that shit everywhere
  ;; idk if there's issues w/ just using all my map yet, i def wanted search and keybinds
  ;; general.el will do this for me automagically later
  ;; source: http://blog.lujun9972.win/emacs-document/blog/2019/03/14/evil-guide/
  (defvar jorge-intercept-mode-map (make-sparse-keymap)
    "higher precendence keymap")

  (define-minor-mode jorge-intercept-mode
    "global minor mode for higher precedence bindings"
    :global t)

  ;; do it after evil-colleciton loads its own helpers
  (with-eval-after-load 'evil
    ;; the alternative is to do this for help-model only
    (jorge-intercept-mode 1)
    (dolist (state '(normal visual motion))
      (let ((state-map (evil-get-auxiliary-keymap 
                        jorge-intercept-mode-map state t t)))
      ;; our state map intercepts on the state
      (evil-make-intercept-map state-map state)
      ;; now we bind our leader prefix in this map
      (define-key state-map (kbd "SPC") jorge/leader-map))))

  ;; Spacemacs-style command palette.
  (define-key jorge/leader-map (kbd "SPC") #'execute-extended-command)

  ;; Tier 1 starter mappings (daily essentials only).
  (define-key jorge/leader-map (kbd "p f") #'find-file)
  (define-key jorge/leader-map (kbd "f s") #'save-buffer)
  (define-key jorge/leader-map (kbd "b d") #'kill-current-buffer)

  (define-key jorge/leader-map (kbd "w v") #'split-window-right)

  (defun jorge/save-and-quit ()
    ;; there's no default save and close split
    ;; i don't want this to also delete the buffer, in emacs i'm used to them just living forever anyways
    ;; evil has something built in but then it's evil specific
    (interactive)

    ;; only try to save if this buffer visits a file
    (when (and (buffer-file-name) (buffer-modified-p))
  	(save-buffer))
    (if (one-window-p)
  	  (bury-buffer)
    (delete-window)))

  ;; =#'foo= means _the function named foo
  (define-key jorge/leader-map (kbd "w q") #'jorge/save-and-quit)
  (define-key jorge/leader-map (kbd "w s") #'split-window-below)
  (define-key jorge/leader-map (kbd "w o") #'other-window)
  (define-key jorge/leader-map (kbd "w h") #'windmove-left)
  (define-key jorge/leader-map (kbd "w j") #'windmove-down)
  (define-key jorge/leader-map (kbd "w k") #'windmove-up)
  (define-key jorge/leader-map (kbd "w l") #'windmove-right)

  (define-key jorge/leader-map (kbd "c r") #'jorge/reload-literate-config)

  ;; when we open a help page, it doesn't auto focus unless this is set
  (setq help-window-select t)
  (define-key jorge/leader-map (kbd "h o") #'describe-symbol)
  (define-key jorge/leader-map (kbd "h o") #'describe-symbol)

  (with-eval-after-load 'which-key
    (define-key jorge/leader-map (kbd "?") #'which-key-show-top-level)
    (which-key-add-key-based-replacements
      "SPC b" "buffers"
      "SPC c" "config"
      "SPC f" "files"
      "SPC h" "help"
      "SPC p" "project"
      "SPC s" "search/symbols"
      "SPC w" "windows"
      "SPC SPC" "M-x / command palette"
      "SPC ?" "which-key help"))
#+end_src

* Phase 1 / Step 2: find/search/navigation (Vertico stack + Consult)
Plain-English mental model:
- minibuffer = the prompt area where Emacs asks you for things (files, commands, symbols)
- this stack upgrades that area without changing core Emacs concepts

What each package does:
- =savehist=: remembers past minibuffer inputs (searches, commands, etc.)
- =vertico=: vertical candidate UI in minibuffer
- =orderless=: fuzzy-ish matching by typing space-separated parts
- =marginalia=: extra annotations in candidate list (type, doc, file info)
- =consult=: the actual high-value commands (search, buffer switch, symbol jump)

Why this is useful:
- faster finding/searching with less memorization
- keeps everything text-first and keyboard-first
- works cleanly with leader mappings

#+begin_src emacs-lisp
(use-package savehist
  :init
  (savehist-mode 1))

(use-package vertico
  :init
  (vertico-mode 1)
  :custom
  (vertico-cycle t))

(use-package orderless
  :custom
  (completion-styles '(orderless basic))
  (completion-category-defaults nil)
  (completion-category-overrides '((file (styles partial-completion)))))

(use-package marginalia
  :after vertico
  :init
  (marginalia-mode 1))

(defun jorge/consult-ripgrep-project ()
  "Search text in project root (fallback: current directory)."
  (interactive)
  (let ((project (project-current nil)))
    (if project
        (consult-ripgrep (project-root project))
      (consult-ripgrep default-directory))))

(use-package consult
  :config
  ;; Better previews for registers and xref results.
  (setq register-preview-delay 0.5
        register-preview-function #'consult-register-format)
  (advice-add #'register-preview :override #'consult-register-window)
  (setq xref-show-xrefs-function #'consult-xref
        xref-show-definitions-function #'consult-xref)

  ;; Leader-first mappings (no extra modifier-key rebinding required).
  (define-key jorge/leader-map (kbd "b b") #'consult-buffer)
  (define-key jorge/leader-map (kbd "/") #'jorge/consult-ripgrep-project)
  (define-key jorge/leader-map (kbd "p s") #'jorge/consult-ripgrep-project)
  (define-key jorge/leader-map (kbd "s l") #'consult-line)
  (define-key jorge/leader-map (kbd "s i") #'consult-imenu)
  (define-key jorge/leader-map (kbd "s o") #'consult-outline))
#+end_src

For now, =embark= is intentionally deferred to keep Phase 1 low-friction.

* UI defaults
#+begin_src emacs-lisp
;; Match Neovim GUI font preference when available.
(let ((preferred-font "JetBrainsMono Nerd Font Mono"))
  (when (display-graphic-p)
    (if (find-font (font-spec :name preferred-font))
        (set-face-attribute 'default nil :font preferred-font :height 140)
      (message "Font not found: %s (keeping default font)" preferred-font))))

;; Keep UI minimal.
(when (fboundp 'menu-bar-mode) (menu-bar-mode -1))
(when (fboundp 'tool-bar-mode) (tool-bar-mode -1))
(when (fboundp 'scroll-bar-mode) (scroll-bar-mode -1))

;; Built-in dark theme.
(load-theme 'modus-vivendi t)
#+end_src

* Editing basics (Neovim-inspired)
#+begin_src emacs-lisp
;; Option A: default to tabs, but let major modes override when needed.
(setq-default indent-tabs-mode t
              tab-width 4)
(setq standard-indent 4)

;; Relative line numbers.
(setq display-line-numbers-type 'relative)
(global-display-line-numbers-mode 1)

;; Clipboard behavior.
(setq select-enable-clipboard t
      select-enable-primary t
      save-interprogram-paste-before-kill t)

;; Split behavior similar to splitright/splitbelow defaults.
(setq split-width-threshold 160
      split-height-threshold nil
      window-combination-resize t)
#+end_src

* Transition cleanup
The temporary global bridge bindings were removed now that Evil is active.

Why:
- avoids conflicting behavior between global remaps and Evil state maps
- reduces cognitive load for learning one consistent key model

Current behavior to know:
- in Evil normal state, use Vim-native motions (including =C-d= /=C-u= / =C-o=)
- in minibuffer/Emacs state, default Emacs behavior remains intact
